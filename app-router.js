// @license Copyright (C) 2015 Erik Ringsmuth - MIT license
!function(t,e){function a(t,a,i){var n=e.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!0,a),i.dispatchEvent(n)}function i(e){var i=v.parseUrl(t.location.href,e.getAttribute("mode"));if(i.hash!==A.hash&&i.path===A.path&&i.search===A.search&&i.isHashPath===A.isHashPath)return g(i.hash),A=i,void 0;A=i;var r={path:i.path};if(a("state-change",r,e)){for(var s=e.firstElementChild;s;){if("APP-ROUTE"===s.tagName&&v.testRoute(s.getAttribute("path"),i.path,e.getAttribute("trailingSlash"),s.hasAttribute("regex")))return n(e,s,i),void 0;s=s.nextSibling}a("not-found",r,e)}}function n(t,e,i){if(e.hasAttribute("redirect"))return t.go(e.getAttribute("redirect"),{replace:!0}),void 0;if(e!==t.activeRoute||"noop"!==e.getAttribute("onUrlChange")){var n={path:i.path,route:e,oldRoute:t.activeRoute};a("activate-route-start",n,t)&&a("activate-route-start",n,e)&&(t.loadingRoute=e,e===t.activeRoute&&"updateModel"===e.getAttribute("onUrlChange")?r(t,e,i,n):e.hasAttribute("import")?s(t,e.getAttribute("import"),e,i,n):e.hasAttribute("element")?u(t,e.getAttribute("element"),e,i,n):e.firstElementChild&&"TEMPLATE"===e.firstElementChild.tagName&&(e.isInlineTemplate=!0,h(t,e.firstElementChild,e,i,n)))}}function r(t,e,i,n){var r=l(t,e,i,n);e.hasAttribute("template")||e.isInlineTemplate?c(e.lastElementChild.templateInstance.model,r):c(e.firstElementChild,r),a("activate-route-end",n,t),a("activate-route-end",n,n.route)}function s(t,a,i,n,r){function s(){u.loaded=!0,o(t,u,a,i,n,r)}var u;b.hasOwnProperty(a)?(u=b[a],u.loaded?o(t,u,a,i,n,r):u.addEventListener("load",s)):(u=e.createElement("link"),u.setAttribute("rel","import"),u.setAttribute("href",a),u.setAttribute("async","async"),u.addEventListener("load",s),u.loaded=!1,e.head.appendChild(u),b[a]=u)}function o(t,e,a,i,n,r){if(i.importLink=e,i===t.loadingRoute)if(i.hasAttribute("template")){var s,o=i.getAttribute("template");s=o?e.import.getElementById(o):e.import.querySelector("template"),h(t,s,i,n,r)}else u(t,i.getAttribute("element")||a.split("/").slice(-1)[0].replace(".html",""),i,n,r)}function u(t,a,i,n,r){var s=e.createElement(a),o=l(t,i,n,r);c(s,o),p(t,s,n,r)}function h(t,a,i,n,r){var s;if("createInstance"in a){var o=l(t,i,n,r);s=a.createInstance(o)}else s=e.importNode(a.content,!0);p(t,s,n,r)}function l(t,e,i,n){var r=v.routeArguments(e.getAttribute("path"),i.path,i.search,e.hasAttribute("regex"),"auto"===t.getAttribute("typecast"));return(e.hasAttribute("bindRouter")||t.hasAttribute("bindRouter"))&&(r.router=t),n.model=r,a("before-data-binding",n,t),a("before-data-binding",n,n.route),n.model}function c(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])}function p(t,e,i,n){d(t.previousRoute),t.previousRoute=t.activeRoute,t.activeRoute=t.loadingRoute,t.loadingRoute=null,t.previousRoute&&t.previousRoute.removeAttribute("active"),t.activeRoute.setAttribute("active","active"),t.hasAttribute("animated-pages")&&n.route!==n.oldRoute||d(t.previousRoute),t.activeRoute.appendChild(e),t.hasAttribute("animated-pages")&&(t.animatedPages.selected=t.activeRoute.getAttribute("path")),i.hash&&!t.hasAttribute("animated-pages")&&g(i.hash),a("activate-route-end",n,t),a("activate-route-end",n,n.route)}function d(t){if(t){var e=t.firstChild;for(t.isInlineTemplate&&(e=t.querySelector("template").nextSibling);e;){var a=e;e=e.nextSibling,t.removeChild(a)}}}function g(t){t&&setTimeout(function(){var a=e.querySelector("html /deep/ "+t)||e.querySelector('html /deep/ [name="'+t.substring(1)+'"]');a&&a.scrollIntoView&&a.scrollIntoView(!0)},0)}function m(t,e,a,i,n){var r=t[e],s=a[i];if("**"===r&&e===t.length-1)return!0;if("undefined"==typeof r||"undefined"==typeof s)return r===s;if(r===s||"*"===r||":"===r.charAt(0))return":"===r.charAt(0)&&"undefined"!=typeof n&&(n[r.substring(1)]=a[i]),m(t,e+1,a,i+1,n);if("**"===r)for(var o=i;o<a.length;o++)if(m(t,e+1,a,o,n))return!0;return!1}var v={},b={},f="ActiveXObject"in t,A={},E=Object.create(HTMLElement.prototype);E.util=v,e.registerElement("app-route",{prototype:Object.create(HTMLElement.prototype)}),E.attachedCallback=function(){"manual"!==this.getAttribute("init")&&this.init()},E.init=function(){function a(){n.previousRoute&&!n.previousRoute.hasAttribute("active")&&d(n.previousRoute)}var n=this;n.isInitialized||(n.isInitialized=!0,n.hasAttribute("trailingSlash")||n.setAttribute("trailingSlash","strict"),n.hasAttribute("mode")||n.setAttribute("mode","auto"),n.hasAttribute("typecast")||n.setAttribute("typecast","auto"),(n.hasAttribute("core-animated-pages")||n.hasAttribute("animated-pages"))&&(n.createShadowRoot(),n.hasAttribute("core-animated-pages")&&n.setAttribute("animated-pages","core-animated-pages"),n.animatedPages=e.createElement(n.getAttribute("animated-pages")),n.animatedPages.appendChild(e.createElement("content")),n.animatedPages.style.position="static",n.animatedPages.setAttribute("valueattr","path"),n.animatedPages.setAttribute("attr-for-selected","path"),n.animatedPages.setAttribute("transitions",n.getAttribute("transitions")),n.animatedPages.setAttribute("animate-initial-selection",n.getAttribute("animate-initial-selection")||"false"),n.shadowRoot.appendChild(n.animatedPages),n.animatedPages.addEventListener("core-animated-pages-transition-end",a),n.animatedPages.addEventListener("neon-animation-finish",a)),n.stateChangeHandler=i.bind(null,n),t.addEventListener("popstate",n.stateChangeHandler,!1),f&&t.addEventListener("hashchange",n.stateChangeHandler,!1),i(n))},E.detachedCallback=function(){t.removeEventListener("popstate",this.stateChangeHandler,!1),f&&t.removeEventListener("hashchange",this.stateChangeHandler,!1)},E.go=function(a,i){"pushstate"!==this.getAttribute("mode")&&(a="hashbang"===this.getAttribute("mode")?"#!"+a:"#"+a),i&&i.replace===!0?t.history.replaceState(null,null,a):t.history.pushState(null,null,a);try{var n=new PopStateEvent("popstate",{bubbles:!1,cancelable:!1,state:{}});"dispatchEvent_"in t?t.dispatchEvent_(n):t.dispatchEvent(n)}catch(r){var s=e.createEvent("CustomEvent");s.initCustomEvent("popstate",!1,!1,{state:{}}),t.dispatchEvent(s)}},v.parseUrl=function(t,a){var i={isHashPath:"hash"===a};if("function"==typeof URL){var n=new URL(t);i.path=n.pathname,i.hash=n.hash,i.search=n.search}else{var r=e.createElement("a");r.href=t,i.path=r.pathname,"/"!==i.path.charAt(0)&&(i.path="/"+i.path),i.hash=r.hash,i.search=r.search}if("pushstate"!==a&&("#/"===i.hash.substring(0,2)?(i.isHashPath=!0,i.path=i.hash.substring(1)):"#!/"===i.hash.substring(0,3)?(i.isHashPath=!0,i.path=i.hash.substring(2)):i.isHashPath&&(i.path=0===i.hash.length?"/":i.hash.substring(1)),i.isHashPath)){i.hash="";var s=i.path.indexOf("#");-1!==s&&(i.hash=i.path.substring(s),i.path=i.path.substring(0,s));var o=i.path.indexOf("?");-1!==o&&(i.search=i.path.substring(o),i.path=i.path.substring(0,o))}return i},v.testRoute=function(t,e,a,i){return"ignore"===a&&("/"===e.slice(-1)&&(e=e.slice(0,-1)),"/"!==t.slice(-1)||i||(t=t.slice(0,-1))),i?v.testRegExString(t,e):t===e||"*"===t?!0:("/"!==t.charAt(0)&&(t="/**/"+t),m(t.split("/"),1,e.split("/"),1))},v.routeArguments=function(t,e,a,i,n){var r={};i||("/"!==t.charAt(0)&&(t="/**/"+t),m(t.split("/"),1,e.split("/"),1,r));var s=a.substring(1).split("&");1===s.length&&""===s[0]&&(s=[]);for(var o=0;o<s.length;o++){var u=s[o],h=u.split("=");r[h[0]]=h.splice(1,h.length-1).join("=")}if(n)for(var l in r)r[l]=v.typecast(r[l]);return r},v.typecast=function(t){return"true"===t?!0:"false"===t?!1:isNaN(t)||""===t||"0"===t.charAt(0)?decodeURIComponent(t):+t},v.testRegExString=function(t,e){if("/"!==t.charAt(0))return!1;t=t.slice(1);var a="";if("/"===t.slice(-1))t=t.slice(0,-1);else{if("/i"!==t.slice(-2))return!1;t=t.slice(0,-2),a="i"}return new RegExp(t,a).test(e)},e.registerElement("app-router",{prototype:E})}(window,document);